<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spelling Practice</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the app */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc;
        }
        .container {
            min-height: 100vh;
        }
        /* Custom focus state */
        input:focus, button:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.5); /* Blue shadow */
        }
        /* Style for the Speak button */
        #speak-btn {
            transition: transform 0.1s ease-in-out;
        }
        #speak-btn:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body>
    <div class="container flex flex-col items-center justify-center p-4 sm:p-8">
        <div class="w-full max-w-lg bg-white shadow-2xl rounded-xl p-6 sm:p-10 border-t-8 border-indigo-600">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-gray-800 text-center mb-6">Spelling Test</h1>

            <!-- Progress and Score -->
            <div class="flex justify-between text-sm font-semibold text-gray-500 mb-6">
                <p>Word: <span id="current-word-number">1</span> / <span id="total-words">80</span></p>
                <p>Score: <span id="score">0</span></p>
            </div>

            <!-- Main Interaction Area -->
            <div class="text-center space-y-6">

                <!-- The Speak Button -->
                <button id="speak-btn"
                        class="w-full py-4 bg-indigo-600 text-white rounded-lg text-lg font-bold shadow-md hover:bg-indigo-700 transition duration-150 flex items-center justify-center space-x-3 disabled:bg-indigo-300">
                    <!-- Speaker icon (lucide-react style inline SVG) -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6">
                        <path d="M11 5L6 9H2v6h4l5 4V5z"></path>
                        <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                    </svg>
                    <span>Click to Hear the Word</span>
                </button>

                <!-- Input Field -->
                <input type="text" id="spelling-input"
                       class="w-full px-4 py-3 border border-gray-300 rounded-lg text-lg text-gray-800 placeholder-gray-400 focus:border-indigo-500 transition duration-150"
                       placeholder="Type the spelling here..." autofocus>

                <!-- Feedback Area -->
                <div id="feedback" class="h-8 text-lg font-semibold transition-opacity duration-300"></div>

                <!-- Action Buttons -->
                <div id="action-buttons" class="flex flex-col sm:flex-row gap-4">
                    <button id="check-btn"
                            class="flex-1 py-3 bg-green-500 text-white rounded-lg text-lg font-bold shadow-md hover:bg-green-600 transition duration-150 disabled:bg-green-300">
                        Check Spelling
                    </button>
                    <button id="next-btn"
                            class="flex-1 py-3 bg-gray-400 text-white rounded-lg text-lg font-bold shadow-md hover:bg-gray-500 transition duration-150"
                            style="display: none;">
                        Next Word
                    </button>
                </div>

                <!-- Correct Spelling Display (Hidden by default) -->
                <div id="correct-spelling-area" class="mt-4 p-3 bg-indigo-100 border-l-4 border-indigo-500 rounded-md hidden">
                    <p class="text-sm font-medium text-gray-700">Correct Spelling:</p>
                    <p id="correct-spelling-text" class="text-xl font-bold text-indigo-800"></p>
                </div>

            </div>
        </div>
    </div>

    <script>
        // Use the SpeechSynthesisUtterance object for Text-to-Speech
        const synth = window.speechSynthesis;
        let isSpeaking = false;

        // --- 1. The Full Word List (80 Words) ---
        const rawWords = [
            "accidentally", "achievement", "across", "apologize/apologise", "appearance", "assassination", "beginning", "believable", "bicycle", "category",
            "colonel", "counselor", "courteous", "criticize/criticise", "curriculum", "deceive", "disappoint", "drunkenness", "either", "embarrass",
            "enough", "equip", "exaggerate", "except", "fluorescent", "fulfill", "government", "guarantee", "guerilla", "harass",
            "hero", "humorous", "hypocrite", "immediately", "independence", "island", "knowledge", "leisure", "maintenance", "marriage",
            "millennium", "millionaire", "miniature", "minutes", "misspell", "mosquito", "necessary", "neutron", "nuisance", "occasion",
            "pavilion", "piece", "potato", "privilege", "pronunciation", "quarantine", "questionnaire", "quiet", "quite", "refrigerator",
            "reservoir", "restaurant", "rheumatism", "rhythm", "roommate", "sacrilegious", "schedule", "simile", "sophomore", "strength",
            "success", "supersede", "syllable", "symmetrical", "synonymous", "technique", "unanimous", "unnecessary", "vacuum", "village"
        ];
        
        // Transform the list into an object structure for easier handling of alternates
        const WORDS_DATA = rawWords.map(item => {
            if (item.includes('/')) {
                const [primary, alternate] = item.split('/');
                return { word: primary.trim(), alternates: [alternate.trim()] };
            }
            return { word: item.trim(), alternates: [] };
        });

        // Total number of words for display
        document.getElementById('total-words').textContent = WORDS_DATA.length;

        // State variables
        let currentWordIndex = 0;
        let score = 0;
        let shuffledWords = [];

        // DOM elements
        const currentWordNumberEl = document.getElementById('current-word-number');
        const scoreEl = document.getElementById('score');
        const speakBtn = document.getElementById('speak-btn');
        const inputEl = document.getElementById('spelling-input');
        const checkBtn = document.getElementById('check-btn');
        const nextBtn = document.getElementById('next-btn');
        const feedbackEl = document.getElementById('feedback');
        const correctSpellingArea = document.getElementById('correct-spelling-area');
        const correctSpellingText = document.getElementById('correct-spelling-text');

        /**
         * Shuffles an array in place (Fisher-Yates algorithm).
         * @param {Array} array - The array to shuffle.
         */
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        /**
         * Initializes the application state, shuffles the words, and loads the first word.
         */
        function init() {
            // Create a copy of the word data and shuffle it
            shuffledWords = [...WORDS_DATA];
            shuffle(shuffledWords);
            
            currentWordIndex = 0;
            score = 0;
            updateUI();
            
            // Speak the first word automatically (after user interaction, if possible)
            setTimeout(speakCurrentWord, 500);
        }

        /**
         * Updates the score and progress displays.
         */
        function updateUI() {
            currentWordNumberEl.textContent = currentWordIndex + 1;
            scoreEl.textContent = score;
            inputEl.value = '';
            inputEl.focus();
            feedbackEl.textContent = '';
            
            // Hide all feedback elements
            correctSpellingArea.classList.add('hidden');
            checkBtn.style.display = 'block';
            nextBtn.style.display = 'none';

            // Handle end of test
            if (currentWordIndex >= shuffledWords.length) {
                currentWordNumberEl.textContent = shuffledWords.length;
                inputEl.disabled = true;
                checkBtn.disabled = true;
                speakBtn.disabled = true;
                feedbackEl.innerHTML = `<span class="text-2xl text-indigo-600">Test Complete! Final Score: ${score}/${shuffledWords.length}</span>`;
            } else {
                inputEl.disabled = false;
                checkBtn.disabled = false;
                speakBtn.disabled = false;
            }
        }

        /**
         * Uses the Web Speech API to speak the current word.
         */
        function speakCurrentWord() {
            if (!synth) {
                feedbackEl.textContent = 'Text-to-Speech not supported in your browser.';
                return;
            }

            if (isSpeaking) {
                synth.cancel();
            }

            if (currentWordIndex >= shuffledWords.length) return; // Stop if test is over

            const wordToSpeak = shuffledWords[currentWordIndex].word;
            const utterance = new SpeechSynthesisUtterance(wordToSpeak);
            
            utterance.lang = 'en-US';
            utterance.rate = 0.8; // Slightly slower speech

            utterance.onstart = () => {
                isSpeaking = true;
                speakBtn.classList.add('animate-pulse');
            };

            utterance.onend = () => {
                isSpeaking = false;
                speakBtn.classList.remove('animate-pulse');
            };

            synth.speak(utterance);
        }

        /**
         * Checks the user's input against the correct spelling and its alternates.
         */
        function checkSpelling() {
            const userInput = inputEl.value.trim().toLowerCase();
            const currentWordObj = shuffledWords[currentWordIndex];
            const primarySpelling = currentWordObj.word.toLowerCase();
            const alternates = currentWordObj.alternates.map(alt => alt.toLowerCase());

            // Check if input matches primary or any alternate spelling
            const isCorrect = userInput === primarySpelling || alternates.includes(userInput);

            if (isCorrect) {
                score++;
                feedbackEl.innerHTML = `<span class="text-green-600">Correct! Well done.</span>`;
            } else {
                feedbackEl.innerHTML = `<span class="text-red-600">Incorrect. Try again or check the spelling.</span>`;
            }

            // Show the correct spelling and control buttons
            checkBtn.style.display = 'none';
            nextBtn.style.display = 'block';
            inputEl.disabled = true;

            // Display the primary spelling and any alternates
            let correctText = primarySpelling.charAt(0).toUpperCase() + primarySpelling.slice(1);
            if (currentWordObj.alternates.length > 0) {
                const alts = currentWordObj.alternates.map(alt => alt.charAt(0).toUpperCase() + alt.slice(1)).join(' / ');
                correctText += ` (Also: ${alts})`;
            }
            correctSpellingText.textContent = correctText;
            correctSpellingArea.classList.remove('hidden');

            // Update the score immediately
            scoreEl.textContent = score;
        }

        /**
         * Moves to the next word.
         */
        function nextWord() {
            currentWordIndex++;
            updateUI();

            if (currentWordIndex < shuffledWords.length) {
                speakCurrentWord(); // Speak the new word
            }
        }

        // --- Event Listeners ---

        speakBtn.addEventListener('click', speakCurrentWord);
        checkBtn.addEventListener('click', checkSpelling);
        nextBtn.addEventListener('click', nextWord);

        // Allow pressing Enter key to check or advance
        inputEl.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                if (checkBtn.style.display === 'block' && !checkBtn.disabled) {
                    checkSpelling();
                } else if (nextBtn.style.display === 'block') {
                    nextWord();
                }
            }
        });

        // Initialize the app on load
        window.onload = init;
    </script>
</body>
</html>
